<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <title>Tic tac toe</title>
		<style>
		*{margin:0px; padding:0px;}
		</style>
        <script>
            window.addEventListener("load", onLoad, false);

            function onLoad() {
                
                var size = document.getElementById("size");
                size.addEventListener("change", onChange, false);
				
                var color = document.getElementById("color");
                color.addEventListener("change", onColor, false);
                makeGame();
				
				var reset = document.getElementById("newGame");
				reset.addEventListener("click",resetPoints,false);
				
				var lengthWin = document.getElementById("winCombo");
				lengthWin.addEventListener("change",setWinLength,false);
				
				var points = document.getElementById("score");
				points.innerHTML = "Cross " + crossPoints + " : "+ circlePoints+" Circle" ;
				
				var nextMove = document.getElementById("nextMove");		
				nextMove.innerHTML = "<span style=\"font-size:30px;\">Turn: <span><img style=\"width:30px;height:30px;\" src=" + circleImg + " />";	
				
            }	
            			
			var boardSize=3;
			var board = [];			
			var color = "#ff0000";
			var move = false;
			var winLendth =3;  
			var strike = 0;				
			var crossImg = "cross.png"
			var circleImg = "circle.png";
			var crossPoints = 0;
			var circlePoints = 0;
			
			
            function makeGame() {
                makeTable();
				
                var main = document.getElementById("main");                
				var size = window.innerWidth/boardSize;
				
		        for (var j = 0; j < boardSize; j++) {
				
                    for (var i = 0; i < boardSize; i++) {
					
                        var m = document.createElement("div");
						m.setAttribute("class", "smallDiv");
						m.setAttribute("id", -1);						
						board[j][i] = m;
                        m.style.width = size + "px";
                        m.style.height = size + "px";
                        m.style.background = color;
                        m.style.position = "absolute";
                        m.style.marginLeft = (i * size) + "px";
                        m.style.marginTop = (j*size) + "px";
                        m.style.border = "dotted 1px #000000";
                        m.addEventListener("mousedown",onDown, false);
                        main.appendChild(m);
						
					    }
                }
				
            }
          
		  function onDown(e) {
                var ten = e.target;   
				var size = window.innerWidth/boardSize;
				var nextMove = document.getElementById("nextMove");				
				if(move)
				{
					
					ten.innerHTML = "<img style=\"width:"+size+"px;height:"+size+"px;\" src=" + crossImg + " />";	
					nextMove.innerHTML = "<span style=\"font-size:30px;\">Turn: <span><img style=\"width:30px;height:30px;\" src=" + circleImg + " />";	
					move = false;					
					ten.removeEventListener("mousedown",onDown);									
					ten.setAttribute("id", 1);
					checkWin();
				}
				
				else
				{

					nextMove.innerHTML = "<span style=\"font-size:30px;\">Turn: <span><img style=\"width:30px;height:30px;\" src=" + crossImg + " />";	
					ten.innerHTML = "<img style=\"width:"+size+"px;height:"+size+"px;\" src=" + circleImg + " />";		
					move = true;
					ten.setAttribute("id", 0);
					ten.removeEventListener("mousedown",onDown);
					checkWin();
					
				}
                
            }
         
			function onChange() {
                var lengthWin = document.getElementById("winCombo");
                var select = document.getElementById("size");
                boardSize = select.value;
				main.innerHTML = "";
				if(lengthWin.value>boardSize)
				{
					lengthWin.value=boardSize;
				}
                makeGame();
                
            }
			
			function setWinLength(){
				var lengthWin = document.getElementById("winCombo");
				if(lengthWin.value<=boardSize)
				{
					winLendth = lengthWin.value;
					newGame();
				}
				else
				{
					alert("To smaall board!");
					lengthWin.value=3;
				}
			}
			
            function onColor() {
                var select = document.getElementById("color");
                color = select.value;
                var me = document.getElementsByClassName("smallDiv");
				for(var i = 0; i<me.length;i++)
				{
					me[i].style.background = color;
					
				}

            }
			
			function newGame(){		
				var points = document.getElementById("score");
				points.innerHTML = "Cross " + crossPoints + " : "+ circlePoints+" Circle" ;
				main.innerHTML = "";				
				makeGame();
			}
			
			function makeTable(){
				for(var i=0;i<boardSize;i++)
				{
					board[i]= [];
				}
			
			}
		
			function resetPoints(){
				circlePoints=0;
				crossPoints=0;
				newGame();
			}

			function checkWin(){
			
					
					checkWinHorizontal();
					
					checkWinVertical();
					
					checkWinLeftDiagonal();
					
					checkWinRightDiagonal();	
					
					checkWinDraw();
			}
			
			function checkWinHorizontal(){
				for(var column = 0 ; column < boardSize;column++)
				{
					var startPosition=0;
					do{
						for (var row = startPosition ; row < boardSize-1;row++)
						{
							var field = (board[column][row].id);
							var nextField = (board[column][row+1].id);	
							
							if(field == nextField && field>-1 && nextField>-1)
							{								
								strike++;																
							}
							else
							{
								strike=0;
							}
							if(strike==winLendth-1)
							{
								WinGame();
							}
							
							
						}
					startPosition++;
					}while(startPosition<boardSize-winLendth);
					strike=0;					
				}
			}
			
			function checkWinVertical(){
				for(var row = 0 ; row < boardSize;row++)
					{
						var startPosition=0;
						do{
							for (var column = startPosition ; column < boardSize-1;column++)
							{
								var field = (board[column][row].id);
								var nextField = (board[column+1][row].id);
								
								if(field == nextField && field>-1 && nextField>-1)
								{									
									strike++;
												
								}
								else
								{
									strike=0;
								}
								if(strike==winLendth-1)
								{
									WinGame();
								}
								
								
							}
						startPosition++;
						}while(startPosition<boardSize-winLendth);						
						strike=0;					
					}
			}
			
			function checkWinLeftDiagonal(){
				var temp = boardSize;
				for(var column = 0 ; column < boardSize; column++) 
				{	
						for(var row = 0 ; row < temp-1; row++) 
						{
							var field = (board[row][column+row].id);
							var nextField = (board[row+1][row+1+column].id);
							
							if(field == nextField && field>-1 && nextField>-1)
							{
								strike++;					
							}
							else
							{
								strike=0;
							}
							if(strike==winLendth-1)
							{
								WinGame();
							}
							
							
						}
					strike=0;
					temp--;
				}
								
				var temp = boardSize;
				for(var column = 0 ; column < boardSize; column++) 
				{	
						for(var row = 0 ; row < temp-1; row++) 
						{
							var field = (board[column+row][row].id);
							var nextField = (board[row+1+column][row+1].id);
							
							if(field == nextField && field>-1 && nextField>-1)
							{
								strike++;					
							}
							else
							{
								strike=0;
							}
							if(strike==winLendth-1)
							{
								WinGame();
							}
							
							
						}
					strike=0;
					temp--;
				}
			
			}
						
			function checkWinRightDiagonal(){
				var temp = boardSize;
				for(var column = boardSize-1 ; column >= 0; column--) 
				{	
						for(var row = 0 ; row < temp-1; row++) 
						{
							var field = (board[column-row][row].id);
							var nextField = (board[column-row-1][row+1].id);
							
							if(field == nextField && field>-1 && nextField>-1)
							{
								strike++;					
							}
							else
							{
								strike=0;
							}
							if(strike==winLendth-1)
							{
								WinGame();
							}
							
							
						}
					strike=0;
					temp--;
				
				}
				
				var temp = boardSize;
				var loop = 0				
				while(loop<boardSize-1)				
				{	var column = boardSize-1;
						for(var row = loop ; row < temp-1; row++) 
						{
							var field = (board[column-row+loop][row].id);
							var nextField = (board[column-row-1+loop][row+1].id);

							if(field == nextField && field>-1 && nextField>-1)
							{
								strike++;					
							}
							else
							{
								strike=0;
							}
							if(strike==winLendth-1)
							{
								WinGame();
							}
							
							
						}
					strike=0;
					loop++;
				}
				strike=0;
				
			}
				
			function checkWinDraw(){
			
				var tie = true;				
				var draw = document.getElementsByClassName("smallDiv");
				for(var i =0;i<draw.length;i++)
				{
					if(draw[i].id ==-1)
					{					
						tie=false;
					}
				}
				if(tie)
				{
					alert("Draw");
					newGame();
				}
			}
			
			function WinGame(){
				if(move)
				{
					alert("Circle won");
					circlePoints++;
					newGame();
				}
				else
				{
					alert("Cross won");
					crossPoints++;
					newGame();
				}
			}
			
		</script>
    </head>
    <body>

        <select id="size">
            <option value="3">3x3</option>
            <option value="4">4x4</option>
            <option value="5">5x5</option>            
        </select>


         <select id="color">
            <option value="#ff0000" style="background-color:#ff0000;">Red</option>
            <option value="#00ff00" style="background-color:#00ff00;">Green</option>
            <option value="#0000ff" style="background-color:#0000ff;">Blue</option>
            <option value="#FFE742" style="background-color:#FFE742;">Yellow</option>
        </select>
		
		<select id="winCombo">
			<option value="3">Length of the Combo: 3</option>
			<option value="4">Length of the Combo: 4</option>
			<option value="5">Length of the Combo: 5</option>	
		</select>
		<button id="newGame" value="button">New Game</button>
        <br />  <br />  
		<p id="nextMove"></p>
		<p id="score"></p>
		
		<br />  <br /> 
        <div id="main"></div>

    </body>
</html>
